<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¢å†›åœŸåŒªæ£‹ - è”æœºå¯¹æˆ˜</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }
        h1 { margin-bottom: 10px; color: #e94560; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        /* å¤§å…ç•Œé¢ */
        .lobby { text-align: center; max-width: 400px; }
        .lobby h2 { margin: 20px 0; color: #fff; }
        .lobby-btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            font-size: 16px; border: none; border-radius: 10px;
            cursor: pointer; transition: all 0.2s;
        }
        .btn-red { background: linear-gradient(145deg, #ff6b6b, #c0392b); color: #fff; }
        .btn-gray { background: linear-gradient(145deg, #666, #444); color: #fff; }
        .btn-red:hover, .btn-gray:hover { transform: translateY(-2px); opacity: 0.9; }
        .input-group { margin: 15px 0; }
        .input-group input {
            width: 100%; padding: 12px; font-size: 16px;
            border: 2px solid #444; border-radius: 8px;
            background: #2d2d44; color: #fff; text-align: center;
        }
        .input-group input::placeholder { color: #888; }
        .faction-select { display: flex; gap: 10px; margin: 15px 0; }
        .faction-btn {
            flex: 1; padding: 20px 10px; border: 3px solid #444;
            border-radius: 10px; cursor: pointer; transition: all 0.2s;
            background: #2d2d44; text-align: center;
        }
        .faction-btn:hover { border-color: #666; }
        .faction-btn.selected { border-color: #e94560; background: rgba(233,69,96,0.2); }
        .faction-btn .icon { font-size: 32px; }
        .faction-btn .name { margin-top: 5px; font-size: 14px; }
        .room-info { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0; }
        .room-id { font-size: 24px; font-weight: bold; color: #e94560; letter-spacing: 3px; }
        .waiting { color: #a0a0a0; margin-top: 10px; }
        .hidden { display: none !important; }
        
        /* è§„åˆ™å±•å¼€æ  */
        .rules-toggle {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 100;
        }
        .rules-btn {
            background: rgba(233,69,96,0.9);
            border: none;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .rules-btn:hover { background: #ff6b6b; }
        .rules-content {
            display: none;
            position: absolute;
            top: 40px;
            left: 0;
            background: rgba(45,45,68,0.95);
            padding: 12px;
            border-radius: 8px;
            width: 280px;
            font-size: 12px;
            line-height: 1.6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .rules-toggle:hover .rules-content { display: block; }
        .rules-content p { margin: 4px 0; }
        .rules-content b { color: #e94560; }
        
</style>
</head>
<body>
    <!-- è§„åˆ™å±•å¼€æ  -->
    <div class="rules-toggle">
        <button class="rules-btn">ğŸ“œ è§„åˆ™</button>
        <div class="rules-content">
            <p><b>çº¢å†›</b>ï¼š3æšï¼Œå¯ç§»åŠ¨ä¸€æ­¥ï¼Œå¯æ”»å‡»</p>
            <p><b>åœŸåŒª</b>ï¼š15æšï¼Œåªèƒ½ç§»åŠ¨ï¼Œä¸èƒ½æ”»å‡»</p>
            <p><b>åƒå­</b>ï¼šçº¢å†›ä¸åœŸåŒªé—´éš”ä¸€ç©ºä½æ—¶å¯åƒ</p>
            <p><b>çº¢å†›èƒœ</b>ï¼šæ¶ˆç­å…¨éƒ¨åœŸåŒª</p>
            <p><b>åœŸåŒªèƒœ</b>ï¼šåŒ…å›´çº¢å†›ä½¿å…¶æ— è·¯å¯èµ°</p>
        </div>
    </div>

    <!-- å¤§å…ç•Œé¢ -->
    <div id="lobbyScreen" class="lobby">
        <h1>ğŸ® çº¢å†›åœŸåŒªæ£‹</h1>
        <p style="color:#a0a0a0;margin-bottom:20px;">è”æœºå¯¹æˆ˜ç‰ˆ</p>
        
        <div id="mainMenu">
            <button class="lobby-btn btn-red" onclick="showCreateRoom()">åˆ›å»ºæˆ¿é—´</button>
            <button class="lobby-btn btn-gray" onclick="showJoinRoom()">åŠ å…¥æˆ¿é—´</button>
            <button class="lobby-btn btn-gray" onclick="showRoomList()">æˆ¿é—´åˆ—è¡¨</button>
            <button class="lobby-btn btn-gray" onclick="window.location.href='/game.html'" style="margin-top:20px;">ğŸ® å•æœºæ¨¡å¼</button>
        </div>
        
        <div id="roomListPanel" class="hidden">
            <h2>å…¬å¼€æˆ¿é—´</h2>
            <div class="room-list" id="roomList">
                <p class="no-rooms">æš‚æ— å¯åŠ å…¥çš„æˆ¿é—´</p>
            </div>
            <button class="lobby-btn btn-gray" onclick="refreshRoomList()">åˆ·æ–°</button>
            <button class="lobby-btn btn-gray" onclick="backToMenu()">è¿”å›</button>
        </div>
        
        <div id="createRoomPanel" class="hidden">
            <h2>åˆ›å»ºæˆ¿é—´</h2>
            <div class="input-group">
                <input type="text" id="customRoomId" placeholder="è‡ªå®šä¹‰æˆ¿é—´å·ï¼ˆå¯é€‰ï¼‰" maxlength="10">
            </div>
            <h3 style="margin:15px 0 10px;font-size:14px;color:#a0a0a0;">é€‰æ‹©é˜µè¥</h3>
            <div class="faction-select">
                <div class="faction-btn" data-faction="red" onclick="selectFaction('red')">
                    <div class="icon">â­</div>
                    <div class="name">çº¢å†›æ–¹</div>
                </div>
                <div class="faction-btn" data-faction="bandit" onclick="selectFaction('bandit')">
                    <div class="icon">ğŸ’€</div>
                    <div class="name">åœŸåŒªæ–¹</div>
                </div>
            </div>
            <button class="lobby-btn btn-red" onclick="createRoom()" id="createBtn" disabled>åˆ›å»ºæˆ¿é—´</button>
            <button class="lobby-btn btn-gray" onclick="backToMenu()">è¿”å›</button>
        </div>

        <div id="joinRoomPanel" class="hidden">
            <h2>åŠ å…¥æˆ¿é—´</h2>
            <div class="input-group">
                <input type="text" id="roomIdInput" placeholder="è¾“å…¥æˆ¿é—´å·" maxlength="6">
            </div>
            <h3 style="margin:15px 0 10px;font-size:14px;color:#a0a0a0;">é€‰æ‹©é˜µè¥</h3>
            <div class="faction-select">
                <div class="faction-btn" data-faction="red" onclick="selectFaction('red')">
                    <div class="icon">â­</div>
                    <div class="name">çº¢å†›æ–¹</div>
                </div>
                <div class="faction-btn" data-faction="bandit" onclick="selectFaction('bandit')">
                    <div class="icon">ğŸ’€</div>
                    <div class="name">åœŸåŒªæ–¹</div>
                </div>
            </div>
            <button class="lobby-btn btn-red" onclick="joinRoom()" id="joinBtn" disabled>åŠ å…¥æˆ¿é—´</button>
            <button class="lobby-btn btn-gray" onclick="backToMenu()">è¿”å›</button>
        </div>
        
        <div id="waitingPanel" class="hidden">
            <div class="room-info">
                <p>æˆ¿é—´å·</p>
                <div class="room-id" id="displayRoomId">------</div>
            </div>
            <p class="waiting">â³ ç­‰å¾…å¯¹æ‰‹åŠ å…¥...</p>
            <button class="lobby-btn btn-gray" onclick="leaveRoom()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="gameScreen" class="hidden">
        <div class="game-header">
            <div class="room-badge">æˆ¿é—´: <span id="gameRoomId"></span></div>
            <div class="spectator-count-badge" id="spectatorCountBadge">
                è§‚æˆ˜ğŸ‘: <span id="spectatorCount">0</span>
                <div class="spectator-emoji-container" id="spectatorEmojiContainer"></div>
            </div>
            <div class="spectator-badge" id="spectatorBadge">
                <span>ğŸ‘ è§‚æˆ˜ä¸­</span>
            </div>
            <div class="my-faction" id="myFactionDisplay"></div>
        </div>
        
        <div class="game-main">
            <div class="game-left">
                <div class="turn-indicator">
                    <div class="turn-icon red-icon" id="redIcon">â­</div>
                    <div class="status" id="status">ç­‰å¾…å¼€å§‹</div>
                    <div class="turn-icon bandit-icon" id="banditIcon">ğŸ’€</div>
                </div>
                <div class="board" id="board">
                    <canvas id="boardCanvas" width="320" height="320"></canvas>
                </div>
                <div class="controls">
                    <button onclick="requestUndo()" id="undoBtn">æ‚”æ£‹</button>
                    <button onclick="requestDraw()" id="drawBtn">æ±‚å’Œ</button>
                    <button onclick="leaveRoom()">é€€å‡ºæˆ¿é—´</button>
                </div>
            </div>
            
            <div class="game-right">
                <div class="chat-box">
                    <div class="chat-header">ğŸ’¬ èŠå¤©</div>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="emoji-bar">
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ˜„')">ğŸ˜„</span>
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ˜¢')">ğŸ˜¢</span>
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ˜ ')">ğŸ˜ </span>
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ‰')">ğŸ‰</span>
                        <span class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</span>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="50">
                        <button onclick="sendChat()">å‘é€</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- å¸ƒå±€é€‰æ‹©é¢æ¿ -->
    <div class="overlay" id="setupPanel">
        <div class="modal">
            <h2>ğŸ¯ çº¢å†›å¸ƒé˜µ</h2>
            <p>ç‚¹å‡»é€‰æ‹©3ä¸ªä½ç½®æ”¾ç½®çº¢å†›æ£‹å­</p>
            <div class="setup-positions" id="setupPositions">
                <div class="setup-pos" data-pos="20">1</div>
                <div class="setup-pos" data-pos="21">2</div>
                <div class="setup-pos" data-pos="22">3</div>
                <div class="setup-pos" data-pos="23">4</div>
                <div class="setup-pos" data-pos="24">5</div>
            </div>
            <p id="setupHint">å·²é€‰: 0/3</p>
            <div class="modal-btns">
                <button class="btn-secondary" onclick="useDefaultSetup()">ä½¿ç”¨é»˜è®¤</button>
                <button onclick="requestSwapFaction()" id="swapFactionBtn">äº¤æ¢é˜µè¥</button>
                <button onclick="confirmSetup()" id="confirmSetupBtn" disabled>ç¡®è®¤å¸ƒé˜µ</button>
            </div>
        </div>
    </div>

    <!-- èƒœåˆ©ç”»é¢ -->
    <div class="overlay" id="victoryOverlay">
        <div class="modal victory-modal">
            <div class="victory-icon" id="victoryIcon">ğŸ‰</div>
            <div class="victory-title" id="victoryTitle">çº¢å†›èƒœåˆ©ï¼</div>
            <div class="victory-sub" id="victorySub"></div>
            <div class="modal-btns">
                <button onclick="requestRematch()">å†æ¥ä¸€å±€</button>
                <button class="btn-secondary" onclick="leaveRoom()">é€€å‡ºæˆ¿é—´</button>
            </div>
        </div>
    </div>

    <!-- æ‚”æ£‹è¯·æ±‚å¼¹çª— -->
    <div class="overlay" id="undoRequestOverlay">
        <div class="modal">
            <h2>ğŸ¤” æ‚”æ£‹è¯·æ±‚</h2>
            <p>å¯¹æ–¹è¯·æ±‚æ‚”æ£‹ï¼Œæ˜¯å¦åŒæ„ï¼Ÿ</p>
            <div class="modal-btns">
                <button onclick="respondUndo(true)">åŒæ„</button>
                <button class="btn-secondary" onclick="respondUndo(false)">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <!-- æ±‚å’Œè¯·æ±‚å¼¹çª— -->
    <div class="overlay" id="drawRequestOverlay">
        <div class="modal">
            <h2>ğŸ¤ æ±‚å’Œè¯·æ±‚</h2>
            <p>å¯¹æ–¹è¯·æ±‚å’Œæ£‹ï¼Œæ˜¯å¦åŒæ„ï¼Ÿ</p>
            <div class="modal-btns">
                <button onclick="respondDraw(true)">åŒæ„</button>
                <button class="btn-secondary" onclick="respondDraw(false)">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <!-- å†æ¥ä¸€å±€è¯·æ±‚å¼¹çª— -->
    <div class="overlay" id="rematchRequestOverlay">
        <div class="modal">
            <h2>ğŸ”„ å†æ¥ä¸€å±€</h2>
            <p>å¯¹æ–¹è¯·æ±‚å†æ¥ä¸€å±€ï¼Œæ˜¯å¦åŒæ„ï¼Ÿ</p>
            <div class="modal-btns">
                <button onclick="respondRematch(true)">åŒæ„</button>
                <button class="btn-secondary" onclick="respondRematch(false)">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <!-- äº¤æ¢é˜µè¥è¯·æ±‚å¼¹çª— -->
    <div class="overlay" id="swapRequestOverlay">
        <div class="modal">
            <h2>ğŸ”„ äº¤æ¢é˜µè¥</h2>
            <p>å¯¹æ–¹è¯·æ±‚äº¤æ¢é˜µè¥ï¼Œæ˜¯å¦åŒæ„ï¼Ÿ</p>
            <div class="modal-btns">
                <button onclick="respondSwap(true)">åŒæ„</button>
                <button class="btn-secondary" onclick="respondSwap(false)">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>

    <script src="client.js"></script>
</body>
</html>
